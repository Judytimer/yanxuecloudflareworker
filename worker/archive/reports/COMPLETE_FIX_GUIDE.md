# Cloudflare Worker API é—®é¢˜å®Œæ•´ä¿®å¤æŒ‡å—

## ğŸ“Š å½“å‰çŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæˆçš„é…ç½®

1. **Worker éƒ¨ç½²** âœ…
   - Worker å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
   - ç‰ˆæœ¬ID: `3f8abf54-2aa6-46f5-a351-5dc0a404793b`
   - ç¯å¢ƒå˜é‡å·²é…ç½®

2. **è·¯ç”±é…ç½®** âœ…
   - è·¯ç”±å·²æ›´æ–°ä¸ºï¼š`api.antech.store/*`
   - é…ç½®æ–‡ä»¶å·²ä¿®å¤

3. **éƒ¨ç½²è„šæœ¬** âœ…
   - `package.json` å·²æ›´æ–°ä¸ºä½¿ç”¨ `--env production`
   - GitHub Actions å·²ä¿®å¤

### âŒ å­˜åœ¨çš„é—®é¢˜

1. **API æ— æ³•è®¿é—®**
   - æµè§ˆå™¨å’Œ curl éƒ½æ— æ³•è¿æ¥
   - é”™è¯¯ï¼š`ERR_CONNECTION_CLOSED` / `SSL_ERROR_SYSCALL`

2. **æ—§è·¯ç”±æœªåˆ é™¤**
   - æ—§è·¯ç”± `api.antech.store`ï¼ˆæ— é€šé…ç¬¦ï¼‰ä»å­˜åœ¨
   - éœ€è¦æ‰‹åŠ¨åˆ é™¤

3. **DNS è®°å½•å¯èƒ½ç¼ºå¤±**
   - `api.antech.store` å¯èƒ½æ²¡æœ‰ DNS è®°å½•
   - éœ€è¦æ·»åŠ  DNS è®°å½•å¹¶å¼€å¯ä»£ç†

## ğŸ”§ å®Œæ•´ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šç™»å½• Cloudflare Dashboard

1. è®¿é—®ï¼šhttps://dash.cloudflare.com
2. ä½¿ç”¨æ‚¨çš„è´¦æˆ·ç™»å½•ï¼ˆ821973181@qq.comï¼‰

### æ­¥éª¤ 2ï¼šæ£€æŸ¥å¹¶æ·»åŠ  DNS è®°å½•

1. **é€‰æ‹©åŸŸå**
   - åœ¨ Dashboard ä¸­é€‰æ‹© `antech.store` åŸŸå

2. **è¿›å…¥ DNS è®¾ç½®**
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ **DNS**
   - æˆ–ç›´æ¥è®¿é—®ï¼šhttps://dash.cloudflare.com/[account-id]/antech.store/dns

3. **æ£€æŸ¥ç°æœ‰è®°å½•**
   - æŸ¥çœ‹æ˜¯å¦å·²æœ‰ `api` å­åŸŸåçš„è®°å½•
   - å¦‚æœå­˜åœ¨ï¼Œæ£€æŸ¥ä»£ç†çŠ¶æ€æ˜¯å¦ä¸º ğŸŸ  **Proxied**

4. **æ·»åŠ  DNS è®°å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰**
   - ç‚¹å‡» **Add record** æŒ‰é’®
   - é…ç½®å¦‚ä¸‹ï¼š
     ```
     Type: A
     Name: api
     IPv4 address: 192.0.2.1
     Proxy status: ğŸŸ  Proxied (å¿…é¡»å¼€å¯ï¼)
     TTL: Auto
     ```
   - ç‚¹å‡» **Save**

   **é‡è¦**ï¼š
   - âœ… ä»£ç†çŠ¶æ€å¿…é¡»è®¾ç½®ä¸º **Proxied**ï¼ˆæ©™è‰²äº‘æœµï¼‰
   - âŒ å¦‚æœè®¾ç½®ä¸º **DNS only**ï¼ˆç°è‰²äº‘æœµï¼‰ï¼ŒWorkers è·¯ç”±ä¸ä¼šç”Ÿæ•ˆ
   - IP åœ°å€å¯ä»¥æ˜¯ä»»æ„å€¼ï¼ˆ192.0.2.1 æ˜¯å¸¸ç”¨å ä½ IPï¼‰

### æ­¥éª¤ 3ï¼šæ£€æŸ¥å¹¶åˆ é™¤æ—§è·¯ç”±

1. **è¿›å…¥ Workers è®¾ç½®**
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ **Workers & Pages**
   - é€‰æ‹© `antech-worker`

2. **æŸ¥çœ‹è·¯ç”±**
   - ç‚¹å‡» **Routes** æ ‡ç­¾é¡µ
   - æŸ¥çœ‹å½“å‰è·¯ç”±åˆ—è¡¨

3. **åˆ é™¤æ—§è·¯ç”±**
   - æ‰¾åˆ°è·¯ç”±ï¼š`api.antech.store`ï¼ˆæ²¡æœ‰é€šé…ç¬¦ `/*`ï¼‰
   - ç‚¹å‡»åˆ é™¤æŒ‰é’®
   - ç¡®è®¤åˆ é™¤

4. **ç¡®è®¤æ–°è·¯ç”±**
   - åº”è¯¥çœ‹åˆ°è·¯ç”±ï¼š`api.antech.store/*`
   - çŠ¶æ€åº”è¯¥ä¸º **Active**

### æ­¥éª¤ 4ï¼šéªŒè¯é…ç½®

ç­‰å¾… 1-2 åˆ†é’Ÿè®© DNS å’Œè·¯ç”±é…ç½®ç”Ÿæ•ˆï¼Œç„¶åæµ‹è¯•ï¼š

**æ–¹æ³• 1ï¼šæµè§ˆå™¨æµ‹è¯•**
```
è®¿é—®: https://api.antech.store/graphql
```
- å¦‚æœçœ‹åˆ° GraphQL ç›¸å…³çš„é”™è¯¯ä¿¡æ¯ â†’ âœ… Worker æ­£åœ¨è¿è¡Œ
- å¦‚æœå®Œå…¨æ— æ³•è¿æ¥ â†’ âŒ æ£€æŸ¥ DNS å’Œè·¯ç”±é…ç½®

**æ–¹æ³• 2ï¼šcurl æµ‹è¯•**
```bash
curl -X POST https://api.antech.store/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"{ __typename }"}'
```

**æ–¹æ³• 3ï¼šæŸ¥çœ‹ Worker æ—¥å¿—**
```bash
cd worker
npx wrangler tail
```
ç„¶åè®¿é—® APIï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è¯·æ±‚æ—¥å¿—

## ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

### DNS é…ç½®
- [ ] DNS è®°å½• `api` å·²æ·»åŠ ï¼ˆType: Aï¼‰
- [ ] ä»£ç†çŠ¶æ€ä¸º ğŸŸ  **Proxied**ï¼ˆæ©™è‰²äº‘æœµï¼‰
- [ ] TTL è®¾ç½®ä¸º Auto

### Worker è·¯ç”±é…ç½®
- [ ] æ—§è·¯ç”± `api.antech.store` å·²åˆ é™¤
- [ ] æ–°è·¯ç”± `api.antech.store/*` å­˜åœ¨ä¸”çŠ¶æ€ä¸º Active
- [ ] Worker çŠ¶æ€ä¸º Active

### éƒ¨ç½²é…ç½®
- [ ] `wrangler.toml` ä¸­è·¯ç”±é…ç½®ä¸º `api.antech.store/*`
- [ ] éƒ¨ç½²å‘½ä»¤ä½¿ç”¨ `--env production`
- [ ] Worker å·²æˆåŠŸéƒ¨ç½²

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœ API ä»ç„¶æ— æ³•è®¿é—®

1. **æ£€æŸ¥ DNS ä¼ æ’­**
   ```bash
   dig api.antech.store
   # æˆ–
   nslookup api.antech.store
   ```
   - åº”è¯¥èƒ½çœ‹åˆ° DNS è®°å½•
   - å¦‚æœçœ‹ä¸åˆ°ï¼Œç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•

2. **æ£€æŸ¥ä»£ç†çŠ¶æ€**
   - åœ¨ Cloudflare Dashboard ä¸­ç¡®è®¤ DNS è®°å½•çš„ä»£ç†çŠ¶æ€
   - å¿…é¡»æ˜¯ ğŸŸ  **Proxied**ï¼Œä¸èƒ½æ˜¯ âšª **DNS only**

3. **æ£€æŸ¥è·¯ç”±ç»‘å®š**
   - ç¡®è®¤è·¯ç”± `api.antech.store/*` å·²ç»‘å®šåˆ° Worker
   - ç¡®è®¤æ²¡æœ‰å†²çªçš„è·¯ç”±

4. **æ£€æŸ¥ Worker æ—¥å¿—**
   ```bash
   npx wrangler tail
   ```
   - è®¿é—® API æ—¶æŸ¥çœ‹æ˜¯å¦æœ‰è¯·æ±‚æ—¥å¿—
   - å¦‚æœæ²¡æœ‰æ—¥å¿—ï¼Œè¯´æ˜è¯·æ±‚æ²¡æœ‰åˆ°è¾¾ Worker

5. **é‡æ–°éƒ¨ç½² Worker**
   ```bash
   cd worker
   npx wrangler deploy --env production
   ```

## ğŸ“ é…ç½®å‚è€ƒ

### wrangler.tomlï¼ˆå½“å‰é…ç½®ï¼‰
```toml
[env.production]
routes = [
  { pattern = "api.antech.store/*", zone_name = "antech.store" }
]
```

### DNS è®°å½•é…ç½®
```
Type: A
Name: api
Content: 192.0.2.1
Proxy: ğŸŸ  Proxied
TTL: Auto
```

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤å®Œæˆåï¼Œåº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… è®¿é—® `https://api.antech.store/graphql`
2. âœ… çœ‹åˆ° GraphQL ç›¸å…³çš„å“åº”ï¼ˆå³ä½¿æ˜¯é”™è¯¯ä¿¡æ¯ä¹Ÿè¯´æ˜ Worker æ­£åœ¨è¿è¡Œï¼‰
3. âœ… åœ¨ Worker æ—¥å¿—ä¸­çœ‹åˆ°è¯·æ±‚è®°å½•
4. âœ… å¯ä»¥æ­£å¸¸å‘é€ GraphQL è¯·æ±‚

## ğŸ“ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåï¼ŒAPI ä»ç„¶æ— æ³•è®¿é—®ï¼Œè¯·æ£€æŸ¥ï¼š

1. åŸŸå `antech.store` æ˜¯å¦å·²åœ¨ Cloudflare ä¸­
2. Nameservers æ˜¯å¦æ­£ç¡®é…ç½®
3. è´¦æˆ·æƒé™æ˜¯å¦è¶³å¤Ÿï¼ˆéœ€è¦ Zone æƒé™ï¼‰
4. è”ç³» Cloudflare æ”¯æŒè·å–å¸®åŠ©

## ğŸ”— ç›¸å…³èµ„æº

- Cloudflare Dashboard: https://dash.cloudflare.com
- Workers è·¯ç”±æ–‡æ¡£: https://developers.cloudflare.com/workers/platform/routes/
- DNS è®°å½•é…ç½®: https://developers.cloudflare.com/dns/manage-dns-records/

